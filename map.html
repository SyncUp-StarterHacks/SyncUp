<!DOCTYPE html>
<html>
<script src="https://code.jquery.com/jquery-3.1.1.js" integrity="sha256-16cdPddA6VdVInumRGo6IbivbERE8p7CQR3HzTBuELA=" crossorigin="anonymous"></script>
<style type="text/css">
    .show {
        display: block !important;
    }
    
    #gmapcontainer {
        display: none;
    }
</style>


<button onclick="openmap()">
    Click for map
</button>
<div id="gmapcontainer" class="" style="display:none;">
    <div id="googleMap" class="" style="width:100%;height:400px;"></div>
</div>

<script>
    var dummydata = [{
        user: 0,
        name: "Elon Musk",
        lat: 0,
        lng: 1
    }, {
        user: 1,
        name: "Elon Musk's no.1 friend",
        lat: 0,
        lng: 10
    }, {
        user: 2,
        name: "Elon Musk's no.2 friend",
        lat: 0,
        lng: 11
    }, {
        user: 3,
        name: "Elon Musk's no.3 friend",
        lat: 1,
        lng: 11
    }, {
        user: 4,
        name: "Elon Musk's no.4 friend",
        lat: 2,
        lng: 11
    }];

    function myMap() {
        var mapProp = {
            center: new google.maps.LatLng(51.508742, -0.120850),
            zoom: 8,
        };
        var map = new google.maps.Map(document.getElementById("googleMap"), mapProp);

        // Try HTML5 geolocation.
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                var pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };
                console.log(pos);
                var infoWindow = new google.maps.InfoWindow({
                    content: "Your location"
                });

                //infoWindow.setPosition(pos);
                //infoWindow.setContent('Location found.');

                var marker = new google.maps.Marker({
                    position: pos,
                    map: map,
                    title: "Your location"
                });
                map.setCenter(pos);

                marker.addListener('click', function() {
                    infoWindow.open(map, marker);
                });
            }, function() {
                //handleLocationError(true, infoWindow, map.getCenter());
            });
        }
        else {
            // Browser doesn't support Geolocation
            //handleLocationError(false, infoWindow, map.getCenter());
        }
        /*dummydata.forEach(function(element) {
            var user_pos = {
                lat: element.lat,
                lng: element.lng
            };
            var marker = new google.maps.Marker({
                position: user_pos,
                map: map,
                title: element.name
            });
            var infoWindow = new google.maps.InfoWindow({
                content: element.name
            });

            if (element.user % 2 == 0) marker.setIcon('http://maps.google.com/mapfiles/ms/icons/blue-dot.png');
        });*/

        var markers = dummydata.map(function(location, i) {
            var user_pos = {
                lat: location.lat,
                lng: location.lng
            };
            var marker = new google.maps.Marker({
                position: user_pos
            });
            var infoWin = new google.maps.InfoWindow();
            google.maps.event.addListener(marker, 'click', function(evt) {
                infoWin.setContent(location.name);
                infoWin.open(map, marker);
            });
            if (location.user % 2 == 0) marker.setIcon('http://maps.google.com/mapfiles/ms/icons/blue-dot.png');
            else marker.setIcon('http://maps.google.com/mapfiles/ms/icons/green-dot.png');
            return marker;
        });
        var markerCluster = new MarkerClusterer(map, markers, {
            imagePath: 'https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m'
        });
    }

    function openmap() {
        //$("#gmapcontainer").addClass("show");
        document.getElementById('gmapcontainer').style.display = "block";
        myMap();
    }
</script>
<script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js">
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAOxoTbEQNWThZd6iG8ufPld1B39zNs_3Y&callback=myMap"></script>


</html>
